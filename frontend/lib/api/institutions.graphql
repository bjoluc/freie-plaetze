fragment Gist on Institution {
  city
  gender
  ageFrom
  ageTo
}

fragment PlacesStat on Institution {
  placesAvailable
  placesTotal
  lastUpdated
}

fragment BasicInstitutionInfo on Institution {
  id
  slug
  name
  photo {
    url
    ref
  }
  ...PlacesStat
  ...Gist
  description {
    document
  }
}

query searchInstitutions($cityOrZip: String!, $radius: Int!, $skip: Int, $take: Int) {
  nearbyInstitutions(
    cityOrZip: $cityOrZip
    radius: $radius
    skip: $skip
    take: $take
    orderBy: { placesAvailable: desc }
  ) {
    ...BasicInstitutionInfo
  }
}

query institutions($skip: Int, $take: Int) {
  institutionsCount
  institutions(skip: $skip, take: $take) {
    ...BasicInstitutionInfo
  }
}

query institutionBySlug($slug: String!) {
  institution(where: { slug: $slug }) {
    ...BasicInstitutionInfo
    logo {
      url
      ref
    }
    street
    streetNumber
    zip
    email
    phone
    mobilePhone
  }
}

fragment TextualInstitutionFields on Institution {
  name
  gender
  ageFrom
  ageTo
  placesAvailable
  placesTotal
  street
  streetNumber
  zip
  city
  homepage
  email
  phone
  mobilePhone
  descriptionPlain
}

fragment EditableInstitutionFields on Institution {
  ...TextualInstitutionFields
  photo {
    url
    ref
  }
  logo {
    url
    ref
  }
}

query myInstitutions($userId: ID!) {
  institutions(where: { owner: { id: { equals: $userId } } }) {
    id
    ...EditableInstitutionFields
  }
}

mutation addInstitution(
  $ownerId: ID!
  $name: String!
  $gender: InstitutionGenderType!
  $ageFrom: Int!
  $ageTo: Int!
  $placesAvailable: Int!
  $placesTotal: Int!
  $street: String!
  $streetNumber: String!
  $zip: String!
  $city: String!
  $homepage: String
  $email: String
  $phone: String
  $mobilePhone: String
  $descriptionPlain: String
  $photo: ImageFieldInput
  $logo: ImageFieldInput
) {
  createInstitution(
    data: {
      owner: { connect: { id: $ownerId } }
      name: $name
      gender: $gender
      ageFrom: $ageFrom
      ageTo: $ageTo
      placesAvailable: $placesAvailable
      placesTotal: $placesTotal
      street: $street
      streetNumber: $streetNumber
      zip: $zip
      city: $city
      homepage: $homepage
      email: $email
      phone: $phone
      mobilePhone: $mobilePhone
      descriptionPlain: $descriptionPlain
      photo: $photo
      logo: $logo
    }
  ) {
    id
    ...EditableInstitutionFields
  }
}

query institutionById($id: ID!) {
  institution(where: { id: $id }) {
    id
    ...EditableInstitutionFields
    lastUpdated
  }
}

mutation updateInstitution(
  $institutionId: ID!
  $name: String!
  $gender: InstitutionGenderType!
  $ageFrom: Int!
  $ageTo: Int!
  $placesAvailable: Int!
  $placesTotal: Int!
  $street: String!
  $streetNumber: String!
  $zip: String!
  $city: String!
  $homepage: String
  $email: String
  $phone: String
  $mobilePhone: String
  $descriptionPlain: String
  $photo: ImageFieldInput
  $logo: ImageFieldInput
) {
  updateInstitution(
    where: { id: $institutionId }
    data: {
      name: $name
      gender: $gender
      ageFrom: $ageFrom
      ageTo: $ageTo
      placesAvailable: $placesAvailable
      placesTotal: $placesTotal
      street: $street
      streetNumber: $streetNumber
      zip: $zip
      city: $city
      homepage: $homepage
      email: $email
      phone: $phone
      mobilePhone: $mobilePhone
      descriptionPlain: $descriptionPlain
      photo: $photo
      logo: $logo
    }
  ) {
    id
    ...EditableInstitutionFields
  }
}

mutation updateAvailablePlaces($institutionId: ID!, $placesAvailable: Int!) {
  updateInstitution(where: { id: $institutionId }, data: { placesAvailable: $placesAvailable }) {
    id
    placesAvailable
    lastUpdated
  }
}
