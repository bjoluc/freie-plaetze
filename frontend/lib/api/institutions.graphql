fragment AgeRange on Institution {
  ageFrom
  ageTo
}

fragment Gist on Institution {
  city
  type
  gender
  ...AgeRange
}

fragment PlacesStat on Institution {
  arePlacesAvailable
  lastUpdated
}

fragment BasicInstitutionInfo on Institution {
  id
  slug
  name
  photo {
    url
  }
  ...PlacesStat
  ...Gist
}

fragment InstitutionPageContent on Institution {
  ...BasicInstitutionInfo
  descriptionPlain
  logo {
    url
  }
  street
  streetNumber
  zip
  homepage
  email
  phone
  mobilePhone
}

query searchInstitutions(
  $cityOrZip: String!
  $radius: Int!
  $age: Int
  $genderTypes: [InstitutionGenderType!]
  $institutionTypes: [InstitutionTypeType!]
  $offset: Int
  $limit: Int
) {
  institutionSearchResults(
    cityOrZip: $cityOrZip
    radius: $radius
    age: $age
    offset: $offset
    limit: $limit
    where: { gender: { in: $genderTypes }, type: { in: $institutionTypes } }
    orderBy: [{ arePlacesAvailable: desc }, { lastUpdated: desc }]
  ) {
    ...BasicInstitutionInfo
  }
  institutionSearchResultsCount(
    cityOrZip: $cityOrZip
    radius: $radius
    age: $age
    where: { gender: { in: $genderTypes }, type: { in: $institutionTypes } }
  )
}

query institutionSlugs {
  institutions {
    slug
  }
}

query institutionBySlug($slug: String!) {
  institution(where: { slug: $slug }) {
    ...InstitutionPageContent
  }
}

fragment TextualInstitutionFields on Institution {
  name
  type
  gender
  ageFrom
  ageTo
  arePlacesAvailable
  street
  streetNumber
  zip
  city
  homepage
  email
  phone
  mobilePhone
  descriptionPlain
}

fragment EditableInstitutionFields on Institution {
  ...TextualInstitutionFields
  photo {
    url
  }
  logo {
    url
  }
}

query myInstitutions($userId: ID!) {
  institutions(where: { owner: { id: { equals: $userId } } }, orderBy: { name: asc }) {
    id
    ...EditableInstitutionFields
    ...InstitutionPageContent
    ...BasicInstitutionInfo
  }
}

mutation addInstitution(
  $ownerId: ID!
  $name: String!
  $type: InstitutionTypeType!
  $gender: InstitutionGenderType!
  $ageFrom: Int!
  $ageTo: Int!
  $arePlacesAvailable: Boolean!
  $street: String!
  $streetNumber: String!
  $zip: String!
  $city: String!
  $homepage: String
  $email: String
  $phone: String
  $mobilePhone: String
  $descriptionPlain: String
  $photo: ImageFieldInput
  $logo: ImageFieldInput
) {
  createInstitution(
    data: {
      owner: { connect: { id: $ownerId } }
      name: $name
      type: $type
      gender: $gender
      ageFrom: $ageFrom
      ageTo: $ageTo
      arePlacesAvailable: $arePlacesAvailable
      street: $street
      streetNumber: $streetNumber
      zip: $zip
      city: $city
      homepage: $homepage
      email: $email
      phone: $phone
      mobilePhone: $mobilePhone
      descriptionPlain: $descriptionPlain
      photo: $photo
      logo: $logo
    }
  ) {
    id
    ...EditableInstitutionFields
  }
}

query institutionById($id: ID!) {
  institution(where: { id: $id }) {
    id
    ...EditableInstitutionFields
    ...InstitutionPageContent
  }
}

mutation updateInstitution(
  $institutionId: ID!
  $name: String!
  $type: InstitutionTypeType!
  $gender: InstitutionGenderType!
  $ageFrom: Int!
  $ageTo: Int!
  $arePlacesAvailable: Boolean!
  $street: String!
  $streetNumber: String!
  $zip: String!
  $city: String!
  $homepage: String
  $email: String
  $phone: String
  $mobilePhone: String
  $descriptionPlain: String
  $photo: ImageFieldInput
  $logo: ImageFieldInput
) {
  updateInstitution(
    where: { id: $institutionId }
    data: {
      name: $name
      type: $type
      gender: $gender
      ageFrom: $ageFrom
      ageTo: $ageTo
      arePlacesAvailable: $arePlacesAvailable
      street: $street
      streetNumber: $streetNumber
      zip: $zip
      city: $city
      homepage: $homepage
      email: $email
      phone: $phone
      mobilePhone: $mobilePhone
      descriptionPlain: $descriptionPlain
      photo: $photo
      logo: $logo
    }
  ) {
    id
    ...EditableInstitutionFields
  }
}

mutation updateArePlacesAvailable($institutionId: ID!, $arePlacesAvailable: Boolean!) {
  updateInstitution(
    where: { id: $institutionId }
    data: { arePlacesAvailable: $arePlacesAvailable }
  ) {
    id
    arePlacesAvailable
    lastUpdated
  }
}

mutation deleteInstitution($institutionId: ID!) {
  deleteInstitution(where: { id: $institutionId }) {
    id
  }
}
